<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Interactive component | NYC crimes</title>
  <meta name="description" content="Chapter 5 Interactive component | NYC crimes" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Interactive component | NYC crimes" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Interactive component | NYC crimes" />
  
  
  

<meta name="author" content="Shumin, Xinhao, and Yuta" />


<meta name="date" content="2022-12-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="results.html"/>
<link rel="next" href="conclusion.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>




<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">NYC Crime</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="proposal.html"><a href="proposal.html"><i class="fa fa-check"></i><b>2</b> Proposal</a>
<ul>
<li class="chapter" data-level="2.1" data-path="proposal.html"><a href="proposal.html#research-topic"><i class="fa fa-check"></i><b>2.1</b> Research topic</a></li>
<li class="chapter" data-level="2.2" data-path="proposal.html"><a href="proposal.html#data-availability"><i class="fa fa-check"></i><b>2.2</b> Data availability</a></li>
<li class="chapter" data-level="2.3" data-path="proposal.html"><a href="proposal.html#data-format"><i class="fa fa-check"></i><b>2.3</b> Data format</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>3</b> Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data.html"><a href="data.html#sources"><i class="fa fa-check"></i><b>3.1</b> Sources</a></li>
<li class="chapter" data-level="3.2" data-path="data.html"><a href="data.html#cleaning-transformation"><i class="fa fa-check"></i><b>3.2</b> Cleaning / transformation</a></li>
<li class="chapter" data-level="3.3" data-path="data.html"><a href="data.html#missing-value-analysis"><i class="fa fa-check"></i><b>3.3</b> Missing value analysis</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>4</b> Results</a>
<ul>
<li class="chapter" data-level="4.1" data-path="results.html"><a href="results.html#time-series-analysis"><i class="fa fa-check"></i><b>4.1</b> Time series analysis</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="results.html"><a href="results.html#occurence-analysis"><i class="fa fa-check"></i><b>4.1.1</b> Occurence Analysis</a></li>
<li class="chapter" data-level="4.1.2" data-path="results.html"><a href="results.html#law-category-analysis"><i class="fa fa-check"></i><b>4.1.2</b> Law Category Analysis</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="results.html"><a href="results.html#geographic-analysis"><i class="fa fa-check"></i><b>4.2</b> Geographic Analysis</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="results.html"><a href="results.html#analysis-for-whole-area-of-nyc"><i class="fa fa-check"></i><b>4.2.1</b> Analysis for whole area of NYC</a></li>
<li class="chapter" data-level="4.2.2" data-path="results.html"><a href="results.html#analysis-for-the-area-near-columbia-university"><i class="fa fa-check"></i><b>4.2.2</b> Analysis for the area near Columbia University</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="interactive-component.html"><a href="interactive-component.html"><i class="fa fa-check"></i><b>5</b> Interactive component</a></li>
<li class="chapter" data-level="6" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>6</b> Conclusion</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">NYC crimes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interactive-component" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Interactive component<a href="interactive-component.html#interactive-component" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We created an interactive heat map in order to show where crimes occur the most/least, and what if we choose a crime type. The interactivity will help you explore the viz/data more flexibly and promptly.
The link to the visualization is <a href="https://yuta555.github.io/">here</a>.</p>
<p>Specifically, the visualization is based on the NYC crime data between 2013 and 2022.</p>
<p>This visualization provides you with interactive experiences in the following way:
- Initially, you will see a heat map for the total number of all types of crime.
- If you click one bar on the bar chart by crime type, the heat map on the left will change so that the based data is limited to the crime type you choose, as well as the color changes.　
- If you hover the cursor over the map, the corresponding precinct number, the crime type and the number of crime incidents are displayed.
- You can reset the heatmap to the initial state by clicking “Reset” button.</p>
<p>Seeing in detail, Murder, Assault and Sexual crime have the similar pattern of the crime frequency by area that Bronx and the outskirts of Brooklyn and Queens have the high frequency of those types of incidents, while Robbery and Harassment equally occurred almost everywhere. Fraud has a totally different pattern from murder incidents, which we think is because the characteristic of suspects might be different.</p>
<script src="https://d3js.org/d3.v7.js"></script>
<script src="https://d3js.org/d3-array.v2.min.js"></script>
<script src="https://d3js.org/d3-geo.v2.min.js"></script>
<pre><code>&lt;style type=&quot;text/css&quot;&gt;
.modal {
    display: none; 
    position: fixed; 
    z-index: 1; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    overflow: auto; 
    background-color: rgb(0,0,0); 
    background-color: rgba(0,0,0,0.7); 
}

// Modal Content/Box
.modal-content {
    background-color: #fefefe;
    margin: 15% auto; 
    padding: 20px;
    border: 1px solid #888;
    width: 80%; 
}

// The Close Button
.close {
    color: #aaa;
    float: right;
    font-size: 32px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

.instruction {
  position: fixed;
  bottom: 40px;
  right: 40px;
  cursor:pointer;
  -webkit-border-radius: 10;
  -moz-border-radius: 10;
  border-radius: 10px;
  font-family: Arial;
  color: white;
  font-size: 14px;
  background: grey;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
  font-weight: bold;
}

.instruction:hover {
  background: black;
  text-decoration: none;
}
&lt;/style&gt;

&lt;body&gt;
    &lt;h2&gt;NYC Crime Heat Map and Bar Chart&lt;/h2&gt;
    &lt;div align=&quot;left&quot; style=&quot;position:relative;top:14px&quot;&gt;
        &lt;button id=&quot;reset&quot;&gt;Reset&lt;/button&gt;
    &lt;/div&gt;
    
&lt;button id=&quot;myBtn&quot; class=&quot;instruction&quot;&gt;Instruction&lt;/button&gt;
&lt;div id=&quot;myModal&quot; class=&quot;modal&quot;&gt;
    &lt;div class=&quot;modal-content&quot;&gt;
        &lt;span class=&quot;close&quot;&gt;&amp;times;&lt;/span&gt;
        &lt;h1&gt;Instructions&lt;/h1&gt;
        &lt;p&gt;The following visualization is based on the NYC crime data between 2013 and 2022 which can be exported from NYC OpenData.&lt;/p&gt;
        &lt;p&gt;This visualization provides you with interactive experiences in the following way:&lt;/p&gt;
        &lt;ul&gt;
            &lt;li&gt;Initially, you will see a heat map for the total number of all types of crime.&lt;/li&gt;
            &lt;li&gt;If you click one bar on the bar chart by crime type, the heat map on the left will change so that the based data is limited to the crime type you choose, as well as the color changes.　&lt;/li&gt;
            &lt;li&gt;You can reset heatmap to the initial state by clicking &quot;Reset&quot; button.&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/div&gt;

    &lt;script&gt;        
var modal = document.getElementById(&#39;myModal&#39;);

// Get the button that opens the modal
var btn = document.getElementById(&quot;myBtn&quot;);

// Get the &lt;span&gt; element that closes the modal
var span = document.getElementsByClassName(&quot;close&quot;)[0];

// When the user clicks on the button, open the modal
btn.onclick = function() {
    modal.style.display = &quot;block&quot;;
}

// When the user clicks on &lt;span&gt; (x), close the modal
span.onclick = function() {
    modal.style.display = &quot;none&quot;;
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modal) {
    modal.style.display = &quot;none&quot;;
    }
}
    
    const SvgWidth = 1200
    const SvgHeight = 600
    
    const MapWidth = 600
    const MapHeight = 400
    const MapMargin = {&quot;left&quot;: -200, &quot;top&quot;: 50}

    const barWidth = 600
    const barHeight = 300
    const barMargin = {&quot;left&quot;: 600, &quot;top&quot;: 100}

var xScale = d3.scaleBand().range ([0, barWidth]).padding(0.4);
var yScale = d3.scaleLinear().range ([barHeight, 0]);
   
    var CRIME_TYPE = &#39;All&#39;;

    const projection = d3.geoMercator()
            .scale(43000)
            .center([-73.94, 40.70]); 

    const pathGenerator = d3.geoPath()
        .projection(projection);
    
    var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;)
                .attr(&quot;width&quot;, SvgWidth)
                .attr(&quot;height&quot;, SvgHeight)
    
    var background = svg.append(&quot;rect&quot;)
                            .attr(&quot;class&quot;, &quot;background&quot;)
                            .attr(&quot;width&quot;, SvgWidth)
                            .attr(&quot;height&quot;, SvgHeight)
                            .style(&#39;fill&#39;, &#39;white&#39;)

    var map = svg.append(&#39;g&#39;)
                      .attr(&#39;width&#39;, MapWidth)
                      .attr(&#39;height&#39;, MapHeight)
                      .attr(&quot;transform&quot;, &quot;translate(&quot; + MapMargin.left+ &quot;,&quot; + MapMargin.top + &quot;)&quot;);
    
    
    // create tooltip
    var tooltip = d3.select(&quot;body&quot;)
        .append(&quot;div&quot;)
        .style(&quot;position&quot;, &quot;absolute&quot;)
        .style(&quot;background-color&quot;, &quot;#CCE7F5&quot;)
        .style(&quot;padding&quot;, &quot;4px&quot;)
        .style(&quot;z-index&quot;, &quot;2&quot;)
        .style(&quot;visibility&quot;, &quot;hidden&quot;)
        .text(&quot;a simple tooltip&quot;);
    
    var CrimeColorMap = {   MURDER: &#39;#4daf4a&#39;, 
                            ASSAULT: &#39;#377eb8&#39;,
                            ROBBERY: &#39;#ff7f00&#39;,
                            SEXUALCRIME: &#39;#984ea3&#39;,
                            FRAUD: &#39;#6C182A&#39;,
                HARRASSMENT: &#39;#ffd700&#39;,
                OTHERS: &#39;#696969&#39;
              }
    
var barChart = svg.append(&#39;g&#39;)
                      .attr(&#39;width&#39;, barWidth)
                      .attr(&#39;height&#39;, barHeight)
                      .attr(&quot;transform&quot;, &quot;translate(&quot; + barMargin.left+ &quot;,&quot; + barMargin.top + &quot;)&quot;);
    
const barColor = d3.scaleOrdinal([&#39;#4daf4a&#39;,&#39;#377eb8&#39;,&#39;#ff7f00&#39;,&#39;#984ea3&#39;,&#39;#6C182A&#39;,&#39;#ffd700&#39;,&#39;#696969&#39;]);
    
var reset_button = d3.select(&quot;button#reset&quot;)
         .on(&#39;click&#39;, function(){
         reset_map();
         reset_bar();
         });


// Heat Map
    d3.json(&#39;police_precincts.geo.json&#39;).then(function(geo_data){
        d3.json(&#39;num_crime.json&#39;).then(function(data){
            var freq_list = [];

    for (id in data){
                freq_list.push(data[id][&#39;All&#39;]);
            }
            maxFreq = d3.max(freq_list);
            minFreq = d3.min(freq_list);
   

            map.selectAll(&#39;path&#39;)
        .data(geo_data.features)
        .enter().append(&#39;path&#39;)
            .attr(&quot;id&quot;, function(d){return d.properties.Precinct})
            .attr(&quot;sum_freq&quot;, function(d){return data[d.properties.Precinct][&#39;All&#39;]})
            .attr(&quot;stroke&quot;,&quot;grey&quot;)
            .attr(&quot;stroke-width&quot;,0.75)
            .style(&#39;fill&#39;, &#39;#E13C19&#39;)
            .style(&#39;fill-opacity&#39;, function(d){
            if (data.hasOwnProperty(d.properties.Precinct)){
                return (data[d.properties.Precinct][&#39;All&#39;] - minFreq) / (maxFreq - minFreq);
            }
            return 0;
            })
            .attr(&#39;d&#39;, pathGenerator)
            .on(&#39;mouseover&#39;, function (d) {
                console.log(d);
                if (CRIME_TYPE == &quot;All&quot;){
                crime_freq = data[this.id][&#39;All&#39;];
                }
                else{
                crime_freq = data[this.id][CRIME_TYPE];
                }
                tooltip.style(&quot;visibility&quot;, &quot;visible&quot;)
                   .text(&quot;Precinct-ID: &quot; + this.id + &quot;,\n&quot; + 
                   &quot;  # of Crime: &quot; + crime_freq + &quot;,  Crime Type: &quot; + CRIME_TYPE);

                d3.select(this).transition()
                    .attr(&#39;stroke&#39;, &#39;black&#39;)
                    .attr(&quot;stroke-width&quot;, 1.2);
            })
            .on(&quot;mousemove&quot;, function(){
                return tooltip.style(&quot;top&quot;, (event.pageY-20)+&quot;px&quot;)
                      .style(&quot;left&quot;,(event.pageX+20)+&quot;px&quot;);})
            .on(&#39;mouseout&#39;, function (d, i) {
                tooltip.style(&quot;visibility&quot;, &quot;hidden&quot;);
                d3.select(this).transition()
                    .attr(&#39;stroke&#39;, &#39;grey&#39;)
                    .attr(&quot;stroke-width&quot;,0.75);   
            })
        });    
    });
    
    
// Bar Chart
d3.json(&#39;num_crime_byType.json&#39;).then(function(data){

    xScale.domain(data.map(function(d) { return d.crime_type; }));
    yScale.domain([0, d3.max(data, function(d) { return d.freq;})]);

    barChart.append(&quot;g&quot;)
    .attr(&quot;transform&quot;, &quot;translate(0,&quot; + barHeight + &quot;)&quot;)
    .call(d3.axisBottom(xScale))
    .append(&quot;text&quot;)
    .attr(&quot;y&quot;, barHeight - 250)
    .attr(&quot;x&quot;, barWidth / 2 + 50)
    .attr(&quot;text-anchor&quot;, &quot;end&quot;)
    .attr(&quot;fill&quot;, &quot;black&quot;)
    .text(&quot;Bar Chart by Crime Type&quot;)
    .style(&quot;font-size&quot;, &quot;14px&quot;);

    barChart.append(&quot;g&quot;)
    .attr(&quot;class&quot;, &quot;yAxis&quot;)
    .call(d3.axisLeft(yScale).tickFormat(function(d){
    return d;
    }).ticks());

    barChart.selectAll(&quot;.bar&quot;).remove();
    barChart.selectAll(&quot;.bar&quot;)
      .data(data)
      .enter().append(&quot;rect&quot;)
    .attr(&quot;class&quot;, &quot;bar&quot;)
    .attr(&quot;x&quot;, function(d) { return xScale(d.crime_type); })
    .attr(&quot;y&quot;, function(d) { return yScale(d.freq); })
    .attr(&quot;width&quot;, xScale.bandwidth())
    .attr(&quot;height&quot;, function(d) { return barHeight - yScale(d.freq); })
    .attr(&quot;fill&quot;, function (d){ return barColor(d.crime_type); })
    .on(&#39;click&#39;, function(event, d){
        d3.select(this).select(&quot;.bar&quot;)
                       .style(&quot;fill&quot;, CrimeColorMap[d.crime_type])
        CRIME_TYPE = d.crime_type
//      highlightBar(d.crime_type)
        update_map(d.crime_type)
        });
 });

//function highlightBar(crimeType){
    //      barChart.select(&#39;.bar&#39;)
    //            .select(&#39;path&#39;)
    //            .style(&#39;fill-opacity&#39;, function(d){
    //                if (data.crime_type == crimeType){
    //                    return 1;
    //                }
    //                return 0.35;
    //            })
    //}
    
    // Function for updating heat map after click
    function update_map(crimeType){
            d3.json(&#39;police_precincts.geo.json&#39;).then(function(geo_data){
                d3.json(&#39;num_crime.json&#39;).then(function(data){
            
                    var crime_freq = [];

        for (id in data){
                        crime_freq.push(data[id][crimeType]);
                    }
                    maxFreq = d3.max(crime_freq);
                    minFreq = d3.min(crime_freq);
        
                    map.selectAll(&#39;path&#39;)
            .style(&quot;fill&quot;, CrimeColorMap[crimeType])
                        .style(&#39;fill-opacity&#39;, function(d){
                            if (data.hasOwnProperty(d.properties.Precinct)){
                                return (data[d.properties.Precinct][crimeType] - minFreq) / (maxFreq - minFreq);
                            }
                            return 0;
                        })

                });    
        });
    }

    function reset_map(){
        d3.json(&#39;police_precincts.geo.json&#39;).then(function(geo_data){
                // console.log(geo_data)
                d3.json(&#39;num_crime.json&#39;).then(function(data){
                    var crime_freq = [];
                    // calculae sum values for each precinct
                    for (id in data){
                        crime_freq.push(data[id][&#39;All&#39;]);
                    }
                    maxFreq = d3.max(crime_freq);
                    minFreq = d3.min(crime_freq);

                    map.selectAll(&#39;path&#39;)
                        .style(&#39;fill&#39;, &#39;#E13C19&#39;)
                        .style(&#39;fill-opacity&#39;, function(d){
                            if (data.hasOwnProperty(d.properties.Precinct)){
                                return (data[d.properties.Precinct][&#39;All&#39;] - minFreq) / (maxFreq - minFreq);
                            }
                            return 0;
                        })

                });    
        });
    }


    &lt;/script&gt;
&lt;/body&gt;</code></pre>
</html>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="results.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Russell-A/NYCrime/edit/main/interactive.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/Russell-A/NYCrime/blob/main/interactive.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
